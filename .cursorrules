# Salesforce Development Rules

## Field-Level Security (FLS) Configuration

When creating custom fields in Salesforce, always configure field-level security for the System Administrator profile:

1. **Retrieve the Admin profile**:
   ```bash
   sf project retrieve start --metadata Profile:Admin --target-org <org-alias>
   ```

2. **Add fieldPermissions to the profile metadata** (`force-app/main/default/profiles/Admin.profile-meta.xml`):
   ```xml
   <fieldPermissions>
       <editable>true</editable>
       <field>ObjectName.FieldName__c</field>
       <readable>true</readable>
   </fieldPermissions>
   ```

3. **Deploy the profile**:
   ```bash
   sf project deploy start --source-dir force-app/main/default/profiles --target-org <org-alias>
   ```

## Custom Field Metadata Structure

When creating custom fields, use this structure:

- **Lookup fields**: Include `<deleteConstraint>SetNull</deleteConstraint>`, `<referenceTo>`, `<relationshipLabel>`, `<relationshipName>`
- **Text fields**: Include `<length>255</length>` and `<unique>false</unique>`
- **Long Text Area**: Include `<length>32000</length>` and `<visibleLines>3</visibleLines>`
- **Currency fields**: Include `<precision>18</precision>` and `<scale>2</scale>`
- **Date fields**: Standard date field structure

Do NOT include `<fieldPermissions>` in the field metadata files themselves - FLS is configured via profiles/permission sets.

## Data Operations

### Creating Records with Salesforce CLI

Use the `sf data create record` command with space-separated key=value pairs:
```bash
sf data create record --sobject Account --values "Name='Value' Field1=Value1 Field2=Value2" --target-org <org-alias>
```

For values with spaces, use single quotes: `"Name='SoFi Stadium'"`

### Updating Records

```bash
sf data update record --sobject Order --record-id <id> --values "Field1=Value1 Field2=Value2" --target-org <org-alias>
```

## Workflow for Creating Custom Fields and Records

1. **Query org** using Salesforce MCP to check existing records and verify object structure
2. **Create field metadata files** in `force-app/main/default/objects/<ObjectName>/fields/`
3. **Deploy fields** using `sf project deploy start` or Salesforce MCP `deploy_metadata`
4. **Retrieve Admin profile** and add fieldPermissions for all new custom fields
5. **Deploy profile** to grant field-level security access
6. **Create/update records** using Salesforce CLI or MCP tools
7. **Verify** records using SOQL queries via MCP

## Important Notes

- System Administrators do NOT automatically have access to new custom fields - FLS must be explicitly configured
- After deploying custom fields, wait a few seconds before attempting to use them via API
- Field-level security is configured at the profile/permission set level, not in the field metadata itself
- Use Salesforce MCP tools for querying and Salesforce CLI for data operations when possible
